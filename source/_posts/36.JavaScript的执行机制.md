---
layout: post
title: JavaScript的执行机制
category: js
tagline: "Supporting tagline"
tags: [js]
description:
date: 2019-9-25 18:10:20
---

记得曾经看到过这样一道面试题：

console 的输出顺序是什么？

```
setTimeout(() => {
  console.log("1111");
}, 0);

console.log("2222");

new Promise((resolve, reject) => {
  console.log("3333");
  resolve()
}).then(() => {
  console.log("4444");
});
```

想要判断 console 的输出顺序，必须了解 JavaScript 的执行机制，不然只能靠感觉去猜，陷入深深的迷茫中 😇😇😇...

### 基本概念

- 调用栈(Call Stack)

  栈是一种数据结构，按照先进后出的原则存储数据，先进入的数据被压入栈底，后进入的数据在栈顶，就像我们叠盘子一样。调用栈就是用栈的特性来管理函数的调用。当函数调用时就压入栈底，执行完后弹出。

- 事件表(Event Table)

  异步操作的事件像 setTimeout、Promise 等都会先加入到 Event Table，它是一个特殊的数据结构，可以知道在特定的事件完成后触发特定的函数，比如 timeout、click 事件，就将回调函数加入到 Event Queue。

- 事件队列(Event Queue)

  队列也是一种数据结构，按照先进先出的原则存储数据，先进入的数据进入对首，后进入的数据进入对尾，就像超市排队结账一样。事件队列就是用队列的特性来管理函数的调用。它接收来自 Event Table 的回调函数，但是并不执行，需要通过某种机制将函数加入到调用栈，这个机制就是事件循环(Event Loop)。

- 同步任务

  前一个任务执行完后才能去执行下一个任务，程序的执行顺序和任务的排列顺序是一致的，比如煮面的同步做法，我们要先烧水，等 5 分钟后水开了，备菜，再煮面。在 js 中，同步任务(如渲染元素)在主线程中执行，且立即执行。

- 异步任务

  一个任务比较耗时，其他任务不用等到这个耗时任务完成后再执行，这个耗时任务就是异步任务。煮面的异步做法就是不等水开就去备菜，再煮面。js 中的异步任务(如加载图片)不进入主线程，而是先加入 Event Table，特定事件触发后将回调函数加入 Event Queue，最后加入到调用栈执行。

众所周知 JavaScript 是一门**单线程语言**，也就意味着同一时间只能完成一个任务。为了防止一些耗时的任务(如加载图片、ajax 请求)影响我们的体验，就需要一种机制去调度任务，这个机制就是 event loop(事件循环)。
