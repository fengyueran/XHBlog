---
layout: post
title: 网页性能优化
category: js
tagline: "Supporting tagline"
tags: [js]
description:
date: 2019-1-05 18:10:20
---

### 研究概况

- 研究内容

  本次研究的主要内容为基于 drive 这个项目的性能优化，这里的性能优化主要是指减少首页的加载时间，具体点说就是减少 drive 首页的加载时间。加载时间主要由浏览器发起请求获得资源的时间和资源获取后解析渲染的时间，我的主要研究内容为前半部分，即资源获取时间。以下的工作基本上都是围绕如何降低资源获取时间来展开，包括减少资源大小，减少网络请求等等。对于影响解析渲染速度的因素暂不做研究。

- 评估方法

  通过 chrome 自有工具 audit 进行跑分评测，以下为 drive 在没有优化前的初始测评(以 commit 189440 作为起始):
  以本地搭建的 drive 环境为基础，没有安装其他 app，也没有用户上传的文件。通过 chrome Audits 测评，其初始性能表现评分为：Performance: 35

  <img style="display:block; margin: auto;border: 1px solid" alt="drive初始评分" src="https://i.imgur.com/HWUqiB7.png" />
  <center>图1. drive初始评分</center>

- 研究目的

  1）drive 性能评分提高到 85 分
  2）给出性能优化的指导性建议

- 研究周期

  3 个月。

### 研究内容

- 浏览器请求资源个数与 Load(资源下载完成时间，包括 css)、FCP(首次内容绘制)时间的关系测试

  1）测试环境

  ```
  测试工具：chrome dvtool Performance模块
  测试方法：测试3次的平均值
  Network: Fast 3G
  CPU: 4 x slowdown
  ```

  2）测试方法

  一个 简单的 html，通过 link 属性逐步增加测试的 css 个数，从 1 个增加到 6 个，因为 chrome 最大并发数为 6，再增加到 7 个(需要排队请求)，再增加到 12 个，再增加到 13 个，测试随着 css 请求个数的增加 FCP 等指标的变化。

    <img style="display:block; margin: auto;border: 1px solid" alt="简单的html" src="https://i.imgur.com/HC863nR.png" />
     <center>图2. 基础html</center>

  因为 css 会阻塞渲染，因此需要下载完成后才能绘制出 body 的内容 123(FCP 绘制的内容)，也就能通过改变 css 的个数来影响 Load 和 FCP 时间。

  3）测试结果

    <img style="display:block; margin: auto;border: 1px solid" alt="7个css请求示意图" src="https://i.imgur.com/wSkvtVp.png" />
      <center>图2. 7个css请求示意图</center>

    <img style="display:block; margin: auto;border: 1px solid" alt="13个css请求示意图" src="https://i.imgur.com/AaR5gfw.png" />
      <center>图2. 13个css请求示意图</center>

### 结论

- 减少 HTTP 请求数量

### 成果
